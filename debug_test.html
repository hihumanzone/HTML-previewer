<!DOCTYPE html>
<html>
<head>
    <title>Debug Test</title>
</head>
<body>
    <script>
        // Helper function to perform case-insensitive file lookup (same as in script.js)
        function findFileInSystem(fileSystem, targetFilename) {
            // First try exact match for performance
            const exactMatch = fileSystem.get(targetFilename);
            if (exactMatch) {
                return exactMatch;
            }
            
            // If no exact match, try case-insensitive search
            const targetLower = targetFilename.toLowerCase();
            for (const [filename, file] of fileSystem) {
                if (filename.toLowerCase() === targetLower) {
                    return file;
                }
            }
            
            return null;
        }

        // Test the replaceAssetReferences function directly with case sensitivity
        function testReplaceAssetReferences() {
            const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="theme.css">
</head>
<body>
    <h1>Test Case Sensitivity</h1>
</body>
</html>`;

            const fileSystem = new Map();
            fileSystem.set('styles.css', {
                content: 'body { color: blue; padding: 2rem; }',
                type: 'css'
            });
            // Note: File is named "Theme.css" (capitalized) but HTML links to "theme.css" (lowercase)
            fileSystem.set('Theme.css', {
                content: 'h1 { color: red; font-size: 3em; }',
                type: 'css'
            });

            console.log('Original HTML:', htmlContent);
            console.log('FileSystem:', fileSystem);

            // Test with the NEW case-insensitive approach
            let processedHtml = htmlContent.replace(/<link([^>]*?)href\s*=\s*["']([^"']+\.css)["']([^>]*?)>/gi, (match, before, filename, after) => {
                console.log('Match found:', match);
                console.log('Filename:', filename);
                const file = findFileInSystem(fileSystem, filename);
                console.log('File from system (case-insensitive):', file);
                if (file && file.type === 'css') {
                    const replacement = `<style>${file.content}</style>`;
                    console.log('Replacement:', replacement);
                    return replacement;
                }
                console.log('No replacement, returning original match');
                return match;
            });

            console.log('Processed HTML (with fix):', processedHtml);
            
            // Test with the OLD case-sensitive approach for comparison
            let oldProcessedHtml = htmlContent.replace(/<link([^>]*?)href\s*=\s*["']([^"']+\.css)["']([^>]*?)>/gi, (match, before, filename, after) => {
                const file = fileSystem.get(filename);
                if (file && file.type === 'css') {
                    return `<style>${file.content}</style>`;
                }
                return match;
            });
            
            console.log('Processed HTML (old approach):', oldProcessedHtml);
            
            return processedHtml;
        }

        testReplaceAssetReferences();
    </script>
</body>
</html>